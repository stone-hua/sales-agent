<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI é”€å† å®æˆ˜ç³»ç»Ÿ</title>
    <!-- å¼•å…¥ Markdown æ¸²æŸ“åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- å›¾æ ‡åº“ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #07C160; /* å¾®ä¿¡ç»¿ */
            --bg-color: #f5f5f5;
            --sidebar-bg: #ffffff;
            --text-color: #333;
            --border-color: #e5e5e5;
            --ai-bubble: #ffffff;
            --user-bubble: #95ec69;
            --hover-color: #f0f0f0;
        }

        [data-theme="dark"] {
            --primary-color: #07C160;
            --bg-color: #1e1e1e;
            --sidebar-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --border-color: #444;
            --ai-bubble: #363636;
            --user-bubble: #056a36;
            --hover-color: #3d3d3d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); height: 100dvh; display: flex; overflow: hidden; transition: background 0.3s; }

        /* --- å¸ƒå±€ --- */
        .app-layout { display: flex; width: 100%; height: 100%; }
        
        /* ä¾§è¾¹æ  (å†å²è®°å½•) */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .sidebar-header { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .new-chat-btn {
            background: var(--primary-color); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .history-list { flex: 1; overflow-y: auto; padding: 10px; }
        .history-item {
            padding: 10px; margin-bottom: 5px; border-radius: 6px; cursor: pointer; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color); display: flex; justify-content: space-between; group;
        }
        .history-item:hover, .history-item.active { background-color: var(--hover-color); }
        .history-item .delete-btn { display: none; color: #999; }
        .history-item:hover .delete-btn { display: block; }

        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; }
        .icon-btn { background: none; border: none; color: var(--text-color); cursor: pointer; font-size: 16px; opacity: 0.7; }
        .icon-btn:hover { opacity: 1; }

        /* ä¸»èŠå¤©åŒº */
        .main-chat { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }

        /* é¡¶éƒ¨é…ç½®æ  (å¯æŠ˜å ) */
        .config-panel {
            background: var(--sidebar-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 15px;
            transition: max-height 0.3s ease, padding 0.3s ease;
            overflow: hidden;
            max-height: 200px; /* å±•å¼€é«˜åº¦ */
        }
        .config-panel.collapsed {
            max-height: 0;
            padding: 0 15px;
            border-bottom: none;
        }
        .config-header {
            display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--sidebar-bg); border-bottom: 1px solid var(--border-color);
        }
        .config-title { font-weight: 600; font-size: 16px; }
        .config-toggle { cursor: pointer; transform: rotate(0deg); transition: transform 0.3s; }
        .config-toggle.rotated { transform: rotate(180deg); }

        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-size: 12px; margin-bottom: 4px; opacity: 0.7; }
        .input-group select, .input-group input {
            width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-color); color: var(--text-color); outline: none;
        }

        /* èŠå¤©å†…å®¹åŒº */
        .chat-box { flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth; }
        .message { display: flex; margin-bottom: 20px; align-items: flex-start; }
        .message.user { flex-direction: row-reverse; }
        
        .avatar { width: 36px; height: 36px; border-radius: 4px; margin: 0 10px; background-size: cover; flex-shrink: 0; }
        .message.user .avatar { display: none; }

        .bubble-container { max-width: 75%; display: flex; flex-direction: column; }
        .bubble {
            padding: 12px 16px; border-radius: 8px; font-size: 15px; line-height: 1.6; word-wrap: break-word; position: relative;
        }
        .message.ai .bubble { background: var(--ai-bubble); border: 1px solid var(--border-color); }
        .message.user .bubble { background: var(--user-bubble); color: #000; }
        
        /* Markdown æ ·å¼ */
        .bubble p { margin-bottom: 8px; }
        .bubble p:last-child { margin-bottom: 0; }
        .bubble ul, .bubble ol { margin-left: 20px; margin-bottom: 8px; }
        .bubble strong { font-weight: 600; }

        /* æ¶ˆæ¯æ“ä½œæ  (å¤åˆ¶/ç‚¹èµ) */
        .msg-actions {
            display: flex; gap: 10px; margin-top: 5px; font-size: 12px; opacity: 0; transition: opacity 0.2s;
        }
        .message:hover .msg-actions { opacity: 1; }
        .message.user .msg-actions { justify-content: flex-end; }
        .action-btn { cursor: pointer; color: #999; display: flex; align-items: center; gap: 3px; }
        .action-btn:hover { color: var(--primary-color); }
        .action-btn.active { color: var(--primary-color); }

        /* æ€è€ƒä¸­åŠ¨ç”» */
        .thinking { display: flex; align-items: center; gap: 4px; padding: 10px; color: #888; font-size: 13px; }
        .dot { width: 6px; height: 6px; background: #888; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* åº•éƒ¨è¾“å…¥åŒº */
        .input-area { padding: 15px; background: var(--sidebar-bg); border-top: 1px solid var(--border-color); display: flex; gap: 10px; align-items: center; }
        .input-area input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); outline: none; }
        .send-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--primary-color); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .send-btn:disabled { background: #ccc; }

        /* ç§»åŠ¨ç«¯é€‚é… */
        .mobile-menu-btn { display: none; font-size: 20px; cursor: pointer; margin-right: 10px; }
        
        @media (max-width: 768px) {
            .sidebar { position: absolute; height: 100%; transform: translateX(-100%); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            .sidebar.open { transform: translateX(0); }
            .mobile-menu-btn { display: block; }
            .bubble-container { max-width: 85%; }
            .config-panel { position: absolute; top: 50px; left: 0; width: 100%; z-index: 90; box-shadow: 0 5px 10px rgba(0,0,0,0.05); }
        }

        /* æ¨¡æ€æ¡† */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center; }
        .modal-content { background: var(--sidebar-bg); padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-layout">
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="new-chat-btn" onclick="startNewChat()">
                <i class="fas fa-plus"></i> å¼€å¯æ–°å¯¹è¯
            </button>
        </div>
        <div class="history-list" id="history-list">
            <!-- å†å²è®°å½•åŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="sidebar-footer">
            <button class="icon-btn" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜"><i class="fas fa-adjust"></i></button>
            <button class="icon-btn" onclick="clearAllData()" title="æ¸…ç©ºç¼“å­˜"><i class="fas fa-trash-alt"></i></button>
            <button class="icon-btn" onclick="showModal('about-modal')" title="ä½¿ç”¨è¯´æ˜"><i class="fas fa-question-circle"></i></button>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-chat">
        <!-- é¡¶éƒ¨æ  -->
        <div class="config-header">
            <div style="display:flex; align-items:center;">
                <i class="fas fa-bars mobile-menu-btn" onclick="toggleSidebar()"></i>
                <span class="config-title" id="chat-title">AI é”€å† æ™ºèƒ½ä½“</span>
            </div>
            <div style="display:flex; gap:15px;">
                <i class="fas fa-cog config-toggle" onclick="toggleConfig()" title="è®¾ç½®"></i>
            </div>
        </div>

        <!-- é…ç½®é¢æ¿ (å¯æŠ˜å ) -->
        <div class="config-panel" id="config-panel">
            <div class="input-group">
                <label>é€‰æ‹©äº§å“</label>
                <select id="product_select" onchange="saveConfig()">
                    <option value="AIåº”ç”¨å®æˆ˜çº¿ä¸‹è¯¾">AIåº”ç”¨å®æˆ˜çº¿ä¸‹è¯¾</option>
                    <option value="AIåº”ç”¨çº¿ä¸Šè¯¾">AIåº”ç”¨çº¿ä¸Šè¯¾</option>
                </select>
            </div>
            <div class="input-group">
                <label>æˆæƒç </label>
                <input type="text" id="auth_code" placeholder="è¾“å…¥å¯†ç " onchange="saveConfig()">
            </div>
        </div>

        <!-- èŠå¤©å†…å®¹ -->
        <div class="chat-box" id="chat-box">
            <!-- æ¶ˆæ¯åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- åº•éƒ¨è¾“å…¥ -->
        <div class="input-area">
            <input type="text" id="user_input" placeholder="è¾“å…¥é—®é¢˜..." enterkeyhint="send">
            <button class="send-btn" id="send_btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
<div class="modal" id="about-modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('about-modal')">&times;</span>
        <h3>ğŸ“š ä½¿ç”¨è¯´æ˜</h3>
        <br>
        <p><strong>1. æˆæƒç™»å½•</strong><br>é¦–æ¬¡ä½¿ç”¨è¯·ç‚¹å‡»å³ä¸Šè§’è®¾ç½®å›¾æ ‡ï¼Œè¾“å…¥è€æ¿åˆ†å‘çš„æˆæƒç ã€‚</p>
        <p><strong>2. åˆ‡æ¢äº§å“</strong><br>åœ¨è®¾ç½®é¢æ¿é€‰æ‹©è¦é”€å”®çš„äº§å“ï¼ŒAIä¼šè‡ªåŠ¨åˆ‡æ¢è¯æœ¯é£æ ¼ã€‚</p>
        <p><strong>3. å¯¹è¯ç®¡ç†</strong><br>ç‚¹å‡»å·¦ä¾§â€œå¼€å¯æ–°å¯¹è¯â€å¯æ¥å¾…æ–°å®¢æˆ·ã€‚å†å²è®°å½•ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
        <p><strong>4. æŠ€å·§</strong><br>é‡åˆ°å›ç­”ä¸æ»¡æ„ï¼Œå¯ä»¥ç‚¹å‡»â€œè¸©â€ï¼Œç³»ç»Ÿä¼šè®°å½•å¹¶ä¼˜åŒ–ã€‚</p>
        <br>
        <p style="font-size:12px; color:#999; text-align:center;">æŠ€æœ¯æ”¯æŒï¼š[ä½ çš„åå­—]</p>
    </div>
</div>

<script>
    // ================= é…ç½®åŒº =================
    const DIFY_API_KEY = 'app-5W5V9gH3CP8QyruCqWvMcgn0'; // æ›¿æ¢ä½ çš„ Key
    const DIFY_BASE_URL = 'https://api.dify.ai/v1'; 
    // =========================================

    let currentConversationId = "";
    let chatHistory = JSON.parse(localStorage.getItem('chat_history_list')) || [];
    let currentTheme = localStorage.getItem('theme') || 'light';

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        loadConfig();
        applyTheme(currentTheme);
        renderHistoryList();
        
        // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œè‡ªåŠ¨å¼€å¯æ–°å¯¹è¯
        if (chatHistory.length === 0) {
            startNewChat();
        } else {
            // åŠ è½½æœ€è¿‘ä¸€æ¬¡å¯¹è¯
            loadConversation(chatHistory[0].id);
        }

        // ç›‘å¬å›è½¦
        document.getElementById('user_input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    });

    // --- æ ¸å¿ƒé€»è¾‘ï¼šå‘é€æ¶ˆæ¯ ---
    async function sendMessage() {
        const input = document.getElementById('user_input');
        const text = input.value.trim();
        const product = document.getElementById('product_select').value;
        const auth = document.getElementById('auth_code').value.trim();

        if (!text) return;
        if (!auth) { alert("è¯·å…ˆåœ¨è®¾ç½®ä¸­è¾“å…¥æˆæƒç ï¼"); toggleConfig(); return; }

        // UI æ›´æ–°
        appendMessage('user', text);
        input.value = '';
        setLoading(true);
        
        // è‡ªåŠ¨æŠ˜å é…ç½®é¢æ¿
        document.getElementById('config-panel').classList.add('collapsed');

        try {
            const response = await fetch(`${DIFY_BASE_URL}/chat-messages`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${DIFY_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    "inputs": { "product_select": product, "auth_code": auth },
                    "query": text,
                    "response_mode": "blocking",
                    "conversation_id": currentConversationId,
                    "user": "web-client-user"
                })
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.message || "è¯·æ±‚å¤±è´¥");

            // ç§»é™¤æ€è€ƒåŠ¨ç”»ï¼Œæ˜¾ç¤ºå›å¤
            removeThinking();
            const msgId = data.message_id; // è·å–æ¶ˆæ¯IDç”¨äºåé¦ˆ
            appendMessage('ai', data.answer, msgId);

            // æ›´æ–°ä¼šè¯ ID
            if (currentConversationId !== data.conversation_id) {
                currentConversationId = data.conversation_id;
                updateConversationTitle(currentConversationId, text); // ä½¿ç”¨ç”¨æˆ·ç¬¬ä¸€å¥è¯ä½œä¸ºæ ‡é¢˜
            }
            
            // ä¿å­˜èŠå¤©è®°å½•åˆ°æœ¬åœ°
            saveMessageToLocal(currentConversationId, 'user', text);
            saveMessageToLocal(currentConversationId, 'ai', data.answer, msgId);

        } catch (error) {
            removeThinking();
            appendMessage('ai', `âŒ é”™è¯¯ï¼š${error.message}`);
        } finally {
            setLoading(false);
        }
    }

    // --- æ ¸å¿ƒé€»è¾‘ï¼šåé¦ˆ (ç‚¹èµ/è¸©) ---
    async function sendFeedback(messageId, rating, btnElement) {
        if (!messageId) return;
        
        // UI ç«‹å³åé¦ˆ
        const parent = btnElement.parentElement;
        const btns = parent.querySelectorAll('.action-btn');
        btns.forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');

        try {
            await fetch(`${DIFY_BASE_URL}/messages/${messageId}/feedbacks`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${DIFY_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "rating": rating, "user": "web-client-user" })
            });
            console.log("Feedback sent:", rating);
        } catch (e) {
            console.error("Feedback failed", e);
        }
    }

    // --- æ ¸å¿ƒé€»è¾‘ï¼šä¼šè¯ç®¡ç† ---
    function startNewChat() {
        currentConversationId = "";
        document.getElementById('chat-box').innerHTML = `
            <div class="message ai">
                <div class="avatar" style="background-image: url('https://cdn-icons-png.flaticon.com/512/4712/4712027.png');"></div>
                <div class="bubble-container"><div class="bubble">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI é”€å† åŠ©æ‰‹ã€‚è¯·ç¡®è®¤å³ä¸Šè§’é€‰æ‹©äº†æ­£ç¡®çš„äº§å“ï¼Œç„¶åå¼€å§‹æé—®ã€‚</div></div>
            </div>
        `;
        document.getElementById('chat-title').innerText = "æ–°å¯¹è¯";
        // å…³é—­ä¾§è¾¹æ  (ç§»åŠ¨ç«¯)
        document.getElementById('sidebar').classList.remove('open');
    }

    function updateConversationTitle(convId, firstQuestion) {
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        const exists = chatHistory.find(c => c.id === convId);
        if (!exists) {
            // æˆªå–å‰10ä¸ªå­—ä½œä¸ºæ ‡é¢˜
            const title = firstQuestion.substring(0, 10) + (firstQuestion.length > 10 ? "..." : "");
            chatHistory.unshift({ id: convId, title: title, messages: [] });
            localStorage.setItem('chat_history_list', JSON.stringify(chatHistory));
            renderHistoryList();
        }
    }

    function loadConversation(convId) {
        currentConversationId = convId;
        const chat = chatHistory.find(c => c.id === convId);
        if (!chat) return;

        document.getElementById('chat-title').innerText = chat.title;
        const box = document.getElementById('chat-box');
        box.innerHTML = ''; // æ¸…ç©ºå½“å‰

        // é‡æ–°æ¸²æŸ“å†å²æ¶ˆæ¯
        // æ³¨æ„ï¼šè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä» localStorage è¯»å– messages æ•°ç»„æ¸²æŸ“
        // ä¸ºäº†æ¼”ç¤ºï¼Œè¿™é‡Œå‡è®¾ messages å·²ç»å­˜äº† HTML (å®é™…å¼€å‘å»ºè®®å­˜ JSON)
        const storedMsgs = JSON.parse(localStorage.getItem(`msg_${convId}`)) || [];
        if (storedMsgs.length === 0) {
             box.innerHTML = `<div class="message ai"><div class="avatar" style="background-image: url('https://cdn-icons-png.flaticon.com/512/4712/4712027.png');"></div><div class="bubble-container"><div class="bubble">è¿™æ˜¯å†å²è®°å½•ï¼š${chat.title}</div></div></div>`;
        } else {
            storedMsgs.forEach(m => appendMessage(m.role, m.content, m.msgId, false));
        }
        
        document.getElementById('sidebar').classList.remove('open');
    }

    function saveMessageToLocal(convId, role, content, msgId = null) {
        let msgs = JSON.parse(localStorage.getItem(`msg_${convId}`)) || [];
        msgs.push({ role, content, msgId });
        localStorage.setItem(`msg_${convId}`, JSON.stringify(msgs));
    }
    
    function deleteChat(convId, event) {
        event.stopPropagation();
        if(!confirm("ç¡®å®šåˆ é™¤æ­¤å¯¹è¯ï¼Ÿ")) return;
        chatHistory = chatHistory.filter(c => c.id !== convId);
        localStorage.setItem('chat_history_list', JSON.stringify(chatHistory));
        localStorage.removeItem(`msg_${convId}`);
        renderHistoryList();
        if(currentConversationId === convId) startNewChat();
    }

    // --- UI æ¸²æŸ“å‡½æ•° ---
    function appendMessage(role, text, msgId = null, save = true) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `message ${role}`;
        
        const avatar = role === 'ai' ? `<div class="avatar" style="background-image: url('https://cdn-icons-png.flaticon.com/512/4712/4712027.png');"></div>` : '';
        const htmlText = marked.parse(text); // Markdown æ¸²æŸ“

        let actionsHtml = '';
        if (role === 'ai' && msgId) {
            actionsHtml = `
                <div class="msg-actions">
                    <span class="action-btn" onclick="copyText(this, '${text.replace(/'/g, "\\'")}')"><i class="fas fa-copy"></i> å¤åˆ¶</span>
                    <span class="action-btn" onclick="sendFeedback('${msgId}', 'like', this)"><i class="fas fa-thumbs-up"></i></span>
                    <span class="action-btn" onclick="sendFeedback('${msgId}', 'dislike', this)"><i class="fas fa-thumbs-down"></i></span>
                </div>
            `;
        }

        div.innerHTML = `${avatar}<div class="bubble-container"><div class="bubble">${htmlText}</div>${actionsHtml}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function setLoading(isLoading) {
        const btn = document.getElementById('send_btn');
        if (isLoading) {
            btn.disabled = true;
            const box = document.getElementById('chat-box');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.id = 'thinking-bubble';
            thinkingDiv.className = 'message ai';
            thinkingDiv.innerHTML = `
                <div class="avatar" style="background-image: url('https://cdn-icons-png.flaticon.com/512/4712/4712027.png');"></div>
                <div class="bubble-container"><div class="bubble thinking">
                    <span>AI æ­£åœ¨æ€è€ƒ</span><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div></div>`;
            box.appendChild(thinkingDiv);
            box.scrollTop = box.scrollHeight;
        } else {
            btn.disabled = false;
        }
    }

    function removeThinking() {
        const el = document.getElementById('thinking-bubble');
        if (el) el.remove();
    }

    function renderHistoryList() {
        const list = document.getElementById('history-list');
        list.innerHTML = chatHistory.map(chat => `
            <div class="history-item ${chat.id === currentConversationId ? 'active' : ''}" onclick="loadConversation('${chat.id}')">
                <span><i class="far fa-comments"></i> ${chat.title}</span>
                <span class="delete-btn" onclick="deleteChat('${chat.id}', event)">&times;</span>
            </div>
        `).join('');
    }

    // --- å·¥å…·å‡½æ•° ---
    function toggleConfig() {
        document.getElementById('config-panel').classList.toggle('collapsed');
        document.querySelector('.config-toggle').classList.toggle('rotated');
    }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function showModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    
    function saveConfig() {
        localStorage.setItem('product', document.getElementById('product_select').value);
        localStorage.setItem('auth', document.getElementById('auth_code').value);
    }
    function loadConfig() {
        if(localStorage.getItem('product')) document.getElementById('product_select').value = localStorage.getItem('product');
        if(localStorage.getItem('auth')) document.getElementById('auth_code').value = localStorage.getItem('auth');
    }
    
    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(currentTheme);
        localStorage.setItem('theme', currentTheme);
    }
    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
    }
    
    function clearAllData() {
        if(confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜å’ŒèŠå¤©è®°å½•ï¼Ÿ")) {
            localStorage.clear();
            location.reload();
        }
    }

    function copyText(btn, text) {
        navigator.clipboard.writeText(text).then(() => {
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
            setTimeout(() => btn.innerHTML = original, 2000);
        });
    }
</script>

</body>
</html>
